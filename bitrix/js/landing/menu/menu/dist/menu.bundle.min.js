this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};(function(t,e,n,a,r,i,o,l){"use strict";function u(t,e){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return babelHelpers.toConsumableArray(t.querySelectorAll(e)).filter(function(t){return t.parentElement.closest(e)===n}).map(function(t){var n=a+1;return{layout:t,children:u(t,e,t,n),depth:a}})}function d(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];t.forEach(function(t){e.push(t);d(t.children,e)});return e}function c(t){if(t==="link"){return BX.Landing.Block.Node.Link}if(t==="img"){return BX.Landing.Block.Node.Img}if(t==="icon"){return BX.Landing.Block.Node.Icon}if(t==="embed"){return BX.Landing.Block.Node.Embed}if(t==="map"){return BX.Landing.Block.Node.Map}if(t==="component"){return BX.Landing.Block.Node.Component}return BX.Landing.Block.Node.Text}function s(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<li class="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</li>\n\t\t"]);s=function e(){return t};return t}function g(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="','" href="','" target="','">',"</a>\n\t\t"]);g=function e(){return t};return t}function f(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<ul class="','">',"</ul>\n\t\t"]);f=function e(){return t};return t}function h(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-menu-add">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);h=function e(){return t};return t}function m(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-menu-add-field">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);m=function e(){return t};return t}function p(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span \n\t\t\t\t\tclass="landing-menu-add-field-clear"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\ttitle="','"\n\t\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t']);p=function e(){return t};return t}function v(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input \n\t\t\t\t\ttype="text" \n\t\t\t\t\tclass="landing-menu-add-field-input"\n\t\t\t\t\tplaceholder="','"\n\t\t\t\t\tonkeydown="','"\n\t\t\t\t\t>\n\t\t\t']);v=function e(){return t};return t}function b(){var t=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<button \n\t\t\t\t\tclass="ui-btn ui-btn-light-border ui-btn-icon-add ui-btn-round landing-ui-menu-add-button"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t</button>\n\t\t\t"]);b=function e(){return t};return t}var L=function(t){babelHelpers.inherits(L,t);function L(){var t;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,L);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(L).call(this,n));t.setEventNamespace("BX.Landing.Menu.Menu");t.code=n.code;t.root=n.root;t.block=n.block;t.manifest=Object.freeze(babelHelpers.objectSpread({},n.manifest));t.cache=new e.Cache.MemoryCache;if(a.Env.getInstance().getType()==="KNOWLEDGE"||a.Env.getInstance().getType()==="GROUP"){if(e.Dom.hasClass(t.root.nextElementSibling,"landing-menu-add")){e.Dom.remove(t.root.nextElementSibling)}e.Dom.addClass(t.root,"landing-menu-root-list");e.Dom.insertAfter(t.getAddPageLayout(),t.root)}e.Event.bind(t.root,"click",function(n){if(n.target.nodeName==="A"){n.preventDefault();var a=e.Dom.attr(n.target,"href");if(a.startsWith("#landing")){var r=e.Text.toNumber(a.replace("#landing",""));t.reloadPage(r)}}});return t}babelHelpers.createClass(L,[{key:"createMenuItem",value:function t(e){var n=this;var a=new BX.Landing.Collection.NodeCollection;Object.entries(this.manifest.nodes).forEach(function(t){var r=babelHelpers.slicedToArray(t,2),i=r[0],o=r[1];var l=babelHelpers.toConsumableArray(e.layout.querySelectorAll(i)).filter(function(t){var a=t.closest(n.manifest.item);return a===e.layout});if(l.length>0){var u=c(o.type);l.forEach(function(t){a.push(new u({node:t,manifest:babelHelpers.objectSpread({},o,{allowInlineEdit:false,menuMode:true})}))})}});return new l.MenuItem({layout:e.layout,children:e.children.map(function(t,e){return n.createMenuItem(babelHelpers.objectSpread({},t,{index:e}))}),selector:"".concat(this.manifest.item,"@").concat(e.index),depth:e.depth,nodes:a})}},{key:"getTree",value:function t(){var e=this;var n=this.manifest.item;return u(this.root,n).map(function(t,n){return e.createMenuItem(babelHelpers.objectSpread({},t,{index:n}))})}},{key:"getFlatTree",value:function t(){return d(this.getTree())}},{key:"getForm",value:function t(){return new o.MenuForm({title:"Menu",type:"menu",code:this.code,forms:this.getFlatTree().map(function(t){return t.getForm()})})}},{key:"getAddPageButton",value:function t(){var a=this;return this.cache.remember("addPageButton",function(){return e.Tag.render(b(),a.onAddPageButtonClick.bind(a),n.Loc.getMessage("LANDING_MENU_CREATE_NEW_PAGE"))})}},{key:"onAddPageTextInputKeydown",value:function t(n){var a=this;if(n.keyCode===13){var r=this.getAddPageInput();var o=r.value;r.value="";r.focus();if(e.Type.isStringFilled(o)){var l=BX.translit(o,{change_case:"L",replace_space:"-",replace_other:""});var u=i.Backend.getInstance();u.createPage({title:o,menuCode:this.code,blockId:this.block,code:l}).then(function(t){var n=a.createLi({text:o,href:"#landing".concat(t),target:"_self",children:[]});e.Dom.append(n,a.root);e.Dom.remove(a.getAddPageField());e.Dom.removeClass(a.root,"landing-menu-root-list-with-field");a.reloadPage(t)})}}}},{key:"reloadPage",value:function t(e){var n=r.Main.getInstance();var i=a.Env.getInstance().getLandingEditorUrl({landing:e});void n.reloadSlider(i)}},{key:"getAddPageInput",value:function t(){var a=this;return this.cache.remember("addPageTextInput",function(){return e.Tag.render(v(),n.Loc.getMessage("LANDING_MENU_CREATE_NEW_PAGE"),a.onAddPageTextInputKeydown.bind(a))})}},{key:"onAddPageInputClearButtonClick",value:function t(e){e.preventDefault();var n=this.getAddPageInput();n.value="";n.focus()}},{key:"getAddPageInputClearButton",value:function t(){var a=this;return this.cache.remember("addPageInputClearButton",function(){return e.Tag.render(p(),a.onAddPageInputClearButtonClick.bind(a),n.Loc.getMessage("LANDING_MENU_CLEAR_FIELD"))})}},{key:"getAddPageField",value:function t(){var n=this;return this.cache.remember("addPageInput",function(){return e.Tag.render(m(),n.getAddPageInput(),n.getAddPageInputClearButton())})}},{key:"getAddPageLayout",value:function t(){var n=this;return this.cache.remember("addPageLayout",function(){return e.Tag.render(h(),n.getAddPageButton())})}},{key:"onAddPageButtonClick",value:function t(n){n.preventDefault();e.Dom.addClass(this.root,"landing-menu-root-list-with-field");e.Dom.prepend(this.getAddPageField(),this.getAddPageLayout());this.getAddPageInput().focus()}},{key:"createList",value:function t(n){var a=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"root";var i=this.manifest[r].ulClassName;return e.Tag.render(f(),i,n.map(function(t){return a.createLi(t,r)}))}},{key:"createA",value:function t(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"root";var r=this.manifest[a].aClassName;return e.Tag.render(g(),r,n.href,n.target,e.Text.encode(n.text))}},{key:"createLi",value:function t(n){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"root";var r=this.manifest[a].liClassName;return e.Tag.render(s(),r,this.createA(n,a),n.children?this.createList(n.children,"children"):undefined)}},{key:"rebuild",value:function t(n){var a=this.createList(n);e.Dom.replace(this.root,a);this.root=a}}]);return L}(e.Event.EventEmitter);t.Menu=L})(this.BX.Landing.Menu=this.BX.Landing.Menu||{},BX,BX.Landing,BX.Landing,BX.Landing,BX.Landing,BX.Landing.UI.Form,BX.Landing.Menu);
//# sourceMappingURL=menu.bundle.map.js